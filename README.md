# pxsol-ss ç¨‹åºæ–‡æ¡£

> Solana é“¾ä¸Šæ•°æ®å­˜å‚¨æœåŠ¡

## ğŸ“– æ¦‚è¿°

`pxsol-ss` æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Solana åŒºå—é“¾ä¸Šçš„æ™ºèƒ½åˆçº¦ï¼ˆç¨‹åºï¼‰ï¼Œæä¾›ç®€å•çš„ Key-Value æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚æ¯ä¸ªç”¨æˆ·å¯ä»¥å­˜å‚¨ä»»æ„å­—èŠ‚æ•°æ®ï¼Œç¨‹åºä¼šè‡ªåŠ¨ç®¡ç†å­˜å‚¨è´¹ç”¨ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| **PDA (Program Derived Address)** | ç”±ç¨‹åºæ´¾ç”Ÿçš„åœ°å€ï¼Œæ²¡æœ‰å¯¹åº”ç§é’¥ï¼Œåªèƒ½ç”±ç¨‹åºæ§åˆ¶ |
| **ç§Ÿé‡‘è±å… (Rent Exemption)** | Solana è´¦æˆ·éœ€è¦æŒæœ‰è¶³å¤Ÿçš„ SOL ä»¥é¿å…è¢«ç³»ç»Ÿå›æ”¶ |
| **Lamports** | Solana çš„æœ€å°è´§å¸å•ä½ï¼Œ1 SOL = 10^9 lamports |

### è´¦æˆ·æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      äº¤æ˜“ (Transaction)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´¦æˆ· #0: account_user     ç”¨æˆ·é’±åŒ…ï¼ˆç­¾åè€…ï¼Œä»˜æ¬¾æ–¹ï¼‰         â”‚
â”‚  è´¦æˆ· #1: account_data     PDA æ•°æ®è´¦æˆ·ï¼ˆå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼‰       â”‚
â”‚  è´¦æˆ· #2: system_program   ç³»ç»Ÿç¨‹åº (11111111...)            â”‚
â”‚  è´¦æˆ· #3: sysvar_rent      ç§Ÿé‡‘ç³»ç»Ÿå˜é‡                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  data: [u8]               ç”¨æˆ·è¦å­˜å‚¨çš„å­—èŠ‚æ•°æ®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PDA åœ°å€æ¨å¯¼

æ•°æ®è´¦æˆ·çš„åœ°å€ä½¿ç”¨ä»¥ä¸‹è§„åˆ™ç”Ÿæˆï¼š

```
PDA = find_program_address([user_pubkey], program_id)
```

è¿™æ„å‘³ç€ï¼š
- æ¯ä¸ªç”¨æˆ·æœ‰å”¯ä¸€çš„æ•°æ®è´¦æˆ·åœ°å€
- åœ°å€å¯ä»¥é€šè¿‡ç”¨æˆ·å…¬é’¥å’Œç¨‹åº ID ç¡®å®šæ€§æ¨å¯¼
- åªæœ‰æœ¬ç¨‹åºå¯ä»¥æ“ä½œè¯¥è´¦æˆ·

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### æµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¼€å§‹äº¤æ˜“   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  è§£æè´¦æˆ·å’Œè®¡ç®—ç§Ÿé‡‘   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è´¦æˆ·ä½™é¢ == 0ï¼Ÿï¼ˆæœªåˆå§‹åŒ–ï¼‰â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Yes           â”‚ No
                    â–¼               â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ åˆ›å»º PDA è´¦æˆ·   â”‚  â”‚ éœ€è¦è¡¥å……ç§Ÿé‡‘ï¼Ÿ     â”‚
          â”‚ å†™å…¥æ•°æ®        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ è¿”å›æˆåŠŸ        â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Yes       â”‚ No
                                   â–¼           â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ ç”¨æˆ·è½¬è´¦   â”‚ â”‚ éœ€è¦é€€è¿˜ï¼Ÿ     â”‚
                          â”‚ è¡¥è¶³å·®é¢   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                                â”‚          â”‚ Yes       â”‚ No
                                â–¼          â–¼           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                          â”‚ é€€è¿˜å¤šä½™ lamports  â”‚       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                    â”‚                  â”‚
                                    â–¼                  â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  é‡æ–°åˆ†é…ç©ºé—´ + å†™å…¥æ–°æ•°æ®      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  è¿”å›æˆåŠŸ   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰ç§æ“ä½œåœºæ™¯

#### åœºæ™¯ 1ï¼šé¦–æ¬¡å­˜å‚¨

å½“ç”¨æˆ·é¦–æ¬¡è°ƒç”¨ç¨‹åºæ—¶ï¼Œæ•°æ®è´¦æˆ·å°šæœªåˆ›å»ºï¼š

1. ç¨‹åºæ£€æµ‹åˆ°è´¦æˆ·ä½™é¢ä¸º 0
2. ä½¿ç”¨ `invoke_signed` è°ƒç”¨ç³»ç»Ÿç¨‹åºåˆ›å»º PDA è´¦æˆ·
3. ä»ç”¨æˆ·è´¦æˆ·æ‰£é™¤ç§Ÿé‡‘è±å…é‡‘é¢
4. å°†æ•°æ®å†™å…¥æ–°è´¦æˆ·

#### åœºæ™¯ 2ï¼šæ›´æ–°æ•°æ®ï¼ˆæ•°æ®å˜å¤§ï¼‰

å½“æ–°æ•°æ®æ¯”åŸæ•°æ®å¤§æ—¶ï¼š

1. è®¡ç®—æ–°çš„ç§Ÿé‡‘è±å…é‡‘é¢
2. ä»ç”¨æˆ·è´¦æˆ·è½¬è´¦å·®é¢åˆ°æ•°æ®è´¦æˆ·
3. é‡æ–°åˆ†é…è´¦æˆ·ç©ºé—´
4. å†™å…¥æ–°æ•°æ®

#### åœºæ™¯ 3ï¼šæ›´æ–°æ•°æ®ï¼ˆæ•°æ®å˜å°ï¼‰

å½“æ–°æ•°æ®æ¯”åŸæ•°æ®å°æ—¶ï¼š

1. è®¡ç®—æ–°çš„ç§Ÿé‡‘è±å…é‡‘é¢
2. å°†å¤šä½™çš„ lamports é€€è¿˜ç»™ç”¨æˆ·
3. é‡æ–°åˆ†é…è´¦æˆ·ç©ºé—´ï¼ˆç¼©å°ï¼‰
4. å†™å…¥æ–°æ•°æ®

## ğŸ’° è´¹ç”¨è¯´æ˜

### ç§Ÿé‡‘è±å…è®¡ç®—

Solana çš„ç§Ÿé‡‘è±å…é‡‘é¢ä¸æ•°æ®å¤§å°æˆæ­£æ¯”ï¼š

```
ç§Ÿé‡‘è±å… = åŸºç¡€è´¹ç”¨ + æ¯å­—èŠ‚è´¹ç”¨ Ã— æ•°æ®å¤§å°
```

æˆªè‡³ç›®å‰ï¼ˆSolana Mainnetï¼‰ï¼Œå¤§çº¦ä¸ºï¼š
- åŸºç¡€è´¹ç”¨ï¼šçº¦ 0.00089 SOL
- æ¯å­—èŠ‚è´¹ç”¨ï¼šçº¦ 0.00000696 SOL

### è´¹ç”¨ç¤ºä¾‹

| æ•°æ®å¤§å° | å¤§çº¦è´¹ç”¨ |
|----------|----------|
| 100 å­—èŠ‚ | ~0.00158 SOL |
| 1 KB | ~0.00802 SOL |
| 10 KB | ~0.07850 SOL |

## ğŸ” å®‰å…¨ç‰¹æ€§

### PDA å®‰å…¨æ€§

- PDA åœ°å€ä½äº ed25519 æ›²çº¿ä¹‹å¤–ï¼Œ**æ²¡æœ‰å¯¹åº”çš„ç§é’¥**
- åªæœ‰æœ¬ç¨‹åºå¯ä»¥å¯¹ PDA è´¦æˆ·è¿›è¡Œç­¾åæ“ä½œ
- ç”¨æˆ·æ— æ³•ç›´æ¥æ§åˆ¶ PDA è´¦æˆ·ä¸­çš„èµ„é‡‘

### èµ„é‡‘å®‰å…¨

- å½“æ•°æ®å˜å°æ—¶ï¼Œå¤šä½™çš„ SOL ä¼šè‡ªåŠ¨é€€è¿˜ç»™ç”¨æˆ·
- ç¨‹åºä¸ä¼šä¿ç•™ä»»ä½•ç”¨æˆ·èµ„é‡‘
- æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œå¤±è´¥æ—¶ä¸ä¼šæœ‰éƒ¨åˆ†æ‰§è¡Œ

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹ (JavaScript/TypeScript)

```typescript
import {
  Connection,
  PublicKey,
  Transaction,
  TransactionInstruction,
  SystemProgram,
  SYSVAR_RENT_PUBKEY,
} from '@solana/web3.js';

// ç¨‹åº IDï¼ˆéƒ¨ç½²åè·å¾—ï¼‰
const PROGRAM_ID = new PublicKey('ä½ çš„ç¨‹åºID');

// è®¡ç®— PDA åœ°å€
function getDataAccountAddress(userPubkey: PublicKey): [PublicKey, number] {
  return PublicKey.findProgramAddressSync(
    [userPubkey.toBytes()],
    PROGRAM_ID
  );
}

// å­˜å‚¨æ•°æ®
async function storeData(
  connection: Connection,
  userPubkey: PublicKey,
  data: Uint8Array
): Promise<Transaction> {
  const [dataAccount] = getDataAccountAddress(userPubkey);

  const instruction = new TransactionInstruction({
    keys: [
      { pubkey: userPubkey, isSigner: true, isWritable: true },
      { pubkey: dataAccount, isSigner: false, isWritable: true },
      { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
      { pubkey: SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
    ],
    programId: PROGRAM_ID,
    data: Buffer.from(data),
  });

  const transaction = new Transaction().add(instruction);
  return transaction;
}
```

### è¯»å–å­˜å‚¨çš„æ•°æ®

```typescript
async function readData(
  connection: Connection,
  userPubkey: PublicKey
): Promise<Uint8Array | null> {
  const [dataAccount] = getDataAccountAddress(userPubkey);
  
  const accountInfo = await connection.getAccountInfo(dataAccount);
  if (!accountInfo) {
    return null; // è´¦æˆ·ä¸å­˜åœ¨
  }
  
  return accountInfo.data;
}
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ„å»ºç¨‹åº

```bash
cargo build-sbf
```

### éƒ¨ç½²ç¨‹åº

```bash
solana program deploy target/deploy/pxsol_ss.so
```

### è¿è¡Œæµ‹è¯•

```bash
cargo test-sbf
```

## ğŸ“š ç›¸å…³èµ„æº

- [Solana å®˜æ–¹æ–‡æ¡£](https://docs.solana.com/)
- [Solana Program å¼€å‘æŒ‡å—](https://docs.solana.com/developing/on-chain-programs/overview)
- [PDA è¯¦è§£](https://docs.solana.com/developing/programming-model/calling-between-programs#program-derived-addresses)
- [ç§Ÿé‡‘æœºåˆ¶](https://docs.solana.com/developing/programming-model/accounts#rent)

solana airdrop 2 <ä½ çš„åœ°å€> --url devnet